"""
handlers/get_pdf.py - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /get_pdf
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ PDF –≥–∞–π–¥–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
"""

def handle_get_pdf(bot, message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /get_pdf - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PDF —Ñ–∞–π–ª —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤.
    
    Args:
        bot: –≠–∫–∑–µ–º–ø–ª—è—Ä telebot.TeleBot
        message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    """
    # –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    msg = bot.reply_to(
        message, 
        "üìÑ *–°–æ–∑–¥–∞—é PDF –≥–∞–π–¥ —Å —à–∞–±–ª–æ–Ω–∞–º–∏...*\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 —Å–µ–∫—É–Ω–¥.", 
        parse_mode="Markdown"
    )
    
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º PDFGenerator –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
        from core.pdf_generator import PDFGenerator
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
        pdf_generator = PDFGenerator()
        pdf_path = pdf_generator.generate_templates_pdf()
        
        if not pdf_path:
            bot.edit_message_text(
                chat_id=message.chat.id,
                message_id=msg.message_id,
                text="‚ùå *–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å PDF —Ñ–∞–π–ª.*\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
                parse_mode="Markdown"
            )
            return
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PDF —Ñ–∞–π–ª
        with open(pdf_path, 'rb') as pdf_file:
            bot.send_document(
                chat_id=message.chat.id,
                document=pdf_file,
                caption=(
                    "üìö *40+ —à–∞–±–ª–æ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ Wildberries/Ozon*\n\n"
                    "‚úÖ 7 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ—Ç–≤–µ—Ç–æ–≤\n"
                    "‚úÖ 40+ –≥–æ—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–∞\n"
                    "‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—ã–Ω–æ–∫\n"
                    "‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è 80% —Ä—É—Ç–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤\n\n"
                    "ü§ñ *–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –±–æ—Ç–µ:*\n"
                    "‚Ä¢ `/—à–∞–±–ª–æ–Ω—ã` ‚Äî –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –≤ Telegram\n"
                    "‚Ä¢ `/—Ç—Ä–µ–∫` ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤\n"
                    "‚Ä¢ `/–º–æ–∏–∑–∞–∫–∞–∑—ã` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤\n"
                    "‚Ä¢ `/–Ω–æ—á—å` ‚Äî –Ω–æ—á–Ω–æ–π —Ä–µ–∂–∏–º"
                ),
                parse_mode="Markdown",
                reply_to_message_id=message.message_id
            )
        
        # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
        bot.delete_message(chat_id=message.chat.id, message_id=msg.message_id)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        bot.send_message(
            message.chat.id,
            "üí° *–°–æ–≤–µ—Ç –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:*\n\n"
            "1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ PDF –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω/–∫–æ–º–ø—å—é—Ç–µ—Ä\n"
            "2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\n"
            "3. –ö–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –ø—Ä—è–º–æ –≤ —á–∞—Ç—ã —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏\n"
            "4. –î–µ–ª–∏—Ç–µ—Å—å —Å –∫–æ–ª–ª–µ–≥–∞–º–∏-–ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏\n\n"
            "üì± *–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/—à–∞–±–ª–æ–Ω—ã` –≤ —ç—Ç–æ–º –±–æ—Ç–µ!*",
            parse_mode="Markdown"
        )
        
    except Exception as e:
        # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF: {e}")
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        bot.edit_message_text(
            chat_id=message.chat.id,
            message_id=msg.message_id,
            text=f"‚ùå *–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF.*\n\n–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: `{str(e)[:100]}`\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode="Markdown"
        )


def register(bot, config):
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /get_pdf
    
    Args:
        bot: –≠–∫–∑–µ–º–ø–ª—è—Ä telebot.TeleBot
        config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ core.config.Config
    """
    @bot.message_handler(commands=['get_pdf'])
    def get_pdf_wrapper(message):
        """–û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ"""
        handle_get_pdf(bot, message)
    
    print("‚úÖ –•–µ–Ω–¥–ª–µ—Ä /get_pdf –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω")